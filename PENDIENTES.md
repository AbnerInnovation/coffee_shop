# Pendientes - Coffee Shop Admin

## üî¥ Alta Prioridad

### 1. Protecci√≥n de Endpoints del Backend
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Implementar validaci√≥n de roles en todos los endpoints del backend para asegurar que la protecci√≥n no sea solo en el frontend.

**Tareas:**
- [ ] Crear decorator/dependency `require_admin` en FastAPI
- [ ] Crear decorator/dependency `require_role` gen√©rico
- [ ] Proteger endpoints de men√∫ (POST, PUT, DELETE, PATCH)
- [ ] Proteger endpoints de categor√≠as (POST, PUT, DELETE)
- [ ] Proteger endpoints de mesas (POST, PUT, DELETE)
- [ ] Proteger endpoints de usuarios (POST, PUT, DELETE)
- [ ] Proteger endpoints de suscripci√≥n (GET, POST, PUT)
- [ ] Proteger endpoints de reportes
- [ ] Agregar tests de permisos en backend

**Archivos a modificar:**
```
backend/app/api/deps.py              # Agregar dependencies de roles
backend/app/api/routers/menu.py      # Proteger endpoints
backend/app/api/routers/categories.py
backend/app/api/routers/tables.py
backend/app/api/routers/users.py
backend/app/api/routers/subscription.py
```

**Ejemplo de implementaci√≥n:**
```python
# backend/app/api/deps.py
def require_admin(current_user: User = Depends(get_current_user)) -> User:
    """Require admin or sysadmin role"""
    if current_user.role not in ['admin', 'sysadmin']:
        raise HTTPException(
            status_code=403,
            detail="Insufficient permissions. Admin role required."
        )
    return current_user

# Uso en endpoints
@router.post("/items/")
async def create_menu_item(
    item: MenuItemCreate,
    current_user: User = Depends(require_admin)  # ‚Üê Protegido
):
    ...
```

---

### 2. Implementaci√≥n de Sub-roles de Staff
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Implementar sistema de sub-roles para el rol STAFF (waiter, cashier, kitchen, general) con permisos espec√≠ficos para cada tipo.

**Sub-roles a implementar:**
- **WAITER** (Mesero): Crear/editar pedidos, gestionar mesas
- **CASHIER** (Cajero): Procesar pagos, acceder a caja registradora
- **KITCHEN** (Cocina): Ver pedidos de cocina, marcar items preparados
- **GENERAL** (General): Solo lectura

**Tareas Backend:**
- [ ] Agregar campo `staff_type` a modelo User
- [ ] Crear migraci√≥n de base de datos
- [ ] Actualizar esquemas Pydantic
- [ ] Modificar endpoint de creaci√≥n de usuarios
- [ ] Actualizar l√≠mites de suscripci√≥n por sub-rol

**Tareas Frontend:**
- [ ] Actualizar formulario de usuario con selector de staff_type
- [ ] Actualizar funciones de permisos en `utils/permissions.ts`
- [ ] Actualizar composable `usePermissions.ts`
- [ ] Actualizar rutas con permisos espec√≠ficos por sub-rol
- [ ] Actualizar navegaci√≥n seg√∫n sub-rol
- [ ] Agregar traducciones para sub-roles

**Archivos a modificar:**

**Backend:**
```
backend/app/models/user.py           # Agregar staff_type
backend/app/schemas/user.py          # Agregar staff_type
backend/app/api/routers/users.py     # Validar staff_type
backend/migrations/versions/xxx.py   # Migraci√≥n
```

**Frontend:**
```
frontend/src/utils/permissions.ts    # Actualizar funciones
frontend/src/composables/usePermissions.ts
frontend/src/components/users/UserFormModal.vue
frontend/src/locales/es.json         # Traducciones
```

**Matriz de permisos por sub-rol:**
```
| Acci√≥n              | WAITER | CASHIER | KITCHEN | GENERAL |
|---------------------|--------|---------|---------|---------|
| Crear pedidos       | ‚úÖ     | ‚ùå      | ‚ùå      | ‚ùå      |
| Ver pedidos         | ‚úÖ     | ‚úÖ      | ‚úÖ      | ‚ùå      |
| Editar pedidos      | ‚úÖ     | ‚ùå      | ‚ùå      | ‚ùå      |
| Gestionar mesas     | ‚úÖ     | ‚ùå      | ‚ùå      | ‚ùå      |
| Procesar pagos      | ‚ùå     | ‚úÖ      | ‚ùå      | ‚ùå      |
| Acceder a caja      | ‚ùå     | ‚úÖ      | ‚ùå      | ‚ùå      |
| Ver cocina          | ‚ùå     | ‚ùå      | ‚úÖ      | ‚ùå      |
| Marcar preparados   | ‚ùå     | ‚ùå      | ‚úÖ      | ‚ùå      |
| Ver men√∫            | ‚úÖ     | ‚úÖ      | ‚úÖ      | ‚úÖ      |
```

---

## üü° Media Prioridad

### 3. Aplicar Permisos a Otras Vistas
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Aplicar el m√≥dulo de permisos a las vistas que a√∫n no lo tienen.

**Vistas a actualizar:**
- [ ] CategoriesView.vue - Botones de crear/editar/eliminar
- [ ] TablesView.vue - Botones de crear/editar/eliminar
- [ ] OrdersView.vue - Botones seg√∫n rol
- [ ] CashRegisterView.vue - Acceso completo
- [ ] KitchenView.vue - Acceso completo
- [ ] DashboardView.vue - Widgets seg√∫n permisos

**Patr√≥n a seguir (igual que MenuList.vue):**
```vue
<script setup>
import { usePermissions } from '@/composables/usePermissions';

const { canEditCategories } = usePermissions();
</script>

<template>
  <button v-if="canEditCategories">
    Agregar Categor√≠a
  </button>
</template>
```

---

### 4. Actualizar Navegaci√≥n con Permisos
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Actualizar App.vue para ocultar enlaces de navegaci√≥n seg√∫n permisos del usuario.

**Tareas:**
- [ ] Actualizar men√∫ desktop con permisos
- [ ] Actualizar men√∫ m√≥vil con permisos
- [ ] Crear computed property con navegaci√≥n filtrada
- [ ] Agregar badges de "Admin" en enlaces administrativos

**Archivo a modificar:**
```
frontend/src/App.vue
```

**Ejemplo:**
```vue
<script setup>
import { usePermissions } from '@/composables/usePermissions';

const {
  canManageTables,
  canEditCategories,
  canAccessCashRegister,
  canAccessKitchen,
  canManageUsers,
  canViewSubscription
} = usePermissions();

const navigation = computed(() => [
  { name: 'Men√∫', to: '/menu', show: true },
  { name: 'Categor√≠as', to: '/categories', show: canEditCategories.value },
  { name: 'Mesas', to: '/tables', show: canManageTables.value },
  { name: 'Pedidos', to: '/orders', show: true },
  { name: 'Cocina', to: '/kitchen', show: canAccessKitchen.value },
  { name: 'Caja', to: '/cash-register', show: canAccessCashRegister.value },
  { name: 'Usuarios', to: '/users', show: canManageUsers.value },
  { name: 'Suscripci√≥n', to: '/subscription', show: canViewSubscription.value }
].filter(item => item.show));
</script>
```

---

### 5. Mejorar Validaciones de Formularios
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Aplicar el m√≥dulo de validaciones a todos los formularios de la aplicaci√≥n.

**Formularios a actualizar:**
- [ ] UserFormModal.vue - Usar validateEmail, validatePassword
- [ ] MenuItemForm.vue - Usar validatePrice, validateRequired
- [ ] CategoryForm.vue - Usar validateRequired, validateName
- [ ] TableForm.vue - Usar validateRequired, validateNumeric
- [ ] LoginView.vue - Usar validateEmail, validatePassword
- [ ] RegisterView.vue - Usar todas las validaciones

**Beneficios:**
- Validaciones consistentes
- Mensajes de error uniformes
- C√≥digo reutilizable
- F√°cil de mantener

---

## üü¢ Baja Prioridad

### 6. Sistema de Notificaciones de Permisos
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Mostrar notificaciones cuando un usuario intenta acceder a algo sin permisos.

**Tareas:**
- [ ] Crear composable useNotifications
- [ ] Agregar toast/notification cuando se bloquea acceso
- [ ] Agregar mensajes personalizados por tipo de permiso
- [ ] Agregar sugerencias (ej: "Contacta al administrador")

---

### 7. Analytics de Permisos
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Registrar intentos de acceso no autorizado para an√°lisis de seguridad.

**Tareas:**
- [ ] Crear servicio de analytics
- [ ] Registrar intentos fallidos de acceso a rutas
- [ ] Registrar intentos fallidos de acceso a endpoints
- [ ] Dashboard de seguridad para sysadmin
- [ ] Alertas de intentos sospechosos

---

### 8. Tests de Permisos
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Crear suite completa de tests para el sistema de permisos.

**Tareas:**
- [ ] Tests unitarios de funciones de permisos
- [ ] Tests de router guards
- [ ] Tests de componentes con permisos
- [ ] Tests E2E de flujos completos por rol
- [ ] Tests de endpoints protegidos en backend

---

### 9. Documentaci√≥n de Usuario
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Crear documentaci√≥n para usuarios finales sobre roles y permisos.

**Tareas:**
- [ ] Gu√≠a de roles y responsabilidades
- [ ] FAQ sobre permisos
- [ ] Videos tutoriales por rol
- [ ] Manual de administrador

---

### 10. Mejoras de UX
**Estado:** ‚¨ú Pendiente

**Descripci√≥n:**
Mejorar la experiencia de usuario relacionada con permisos.

**Tareas:**
- [ ] Tooltips explicando por qu√© un bot√≥n est√° deshabilitado
- [ ] P√°ginas de "Sin permisos" personalizadas
- [ ] Onboarding por rol
- [ ] Badges visuales de rol en UI

---

## ‚úÖ Completado

### ‚úì M√≥dulo de Validaciones Reutilizable
**Estado:** ‚úÖ Completado

**Archivos creados:**
- `frontend/src/utils/permissions.ts`
- `frontend/src/utils/validators.ts`
- `frontend/src/composables/usePermissions.ts`
- `VALIDATION_MODULE_GUIDE.md`

---

### ‚úì Protecci√≥n de Rutas con M√≥dulo de Permisos
**Estado:** ‚úÖ Completado

**Archivos modificados:**
- `frontend/src/routes.ts`
- `frontend/src/router.ts`
- `ROUTE_PERMISSIONS_GUIDE.md`

---

### ‚úì Protecci√≥n de Vista de Men√∫
**Estado:** ‚úÖ Completado

**Archivos modificados:**
- `frontend/src/components/menu/MenuList.vue`
- `MENU_ROLE_BASED_ACCESS.md`

---

### ‚úì Protecci√≥n de Vista de Suscripci√≥n
**Estado:** ‚úÖ Completado

**Archivos modificados:**
- `frontend/src/App.vue`
- `frontend/src/routes.ts`
- `SUBSCRIPTION_ACCESS_RESTRICTION.md`

---

## üìã Resumen de Progreso

**Total de tareas:** 10
- ‚úÖ Completadas: 4 (40%)
- üî¥ Alta prioridad: 2
- üü° Media prioridad: 3
- üü¢ Baja prioridad: 5

---

## üéØ Pr√≥ximos Pasos Recomendados

1. **Implementar sub-roles de staff** (Alta prioridad)
   - Impacto: Alto
   - Esfuerzo: Medio
   - Dependencias: Ninguna

2. **Proteger endpoints del backend** (Alta prioridad)
   - Impacto: Cr√≠tico (seguridad)
   - Esfuerzo: Medio
   - Dependencias: Ninguna

3. **Aplicar permisos a otras vistas** (Media prioridad)
   - Impacto: Alto
   - Esfuerzo: Bajo
   - Dependencias: Ninguna

---

## üìù Notas

- El sistema de permisos est√° completamente funcional y listo para extenderse
- La arquitectura es escalable y mantenible
- Todos los cambios futuros seguir√°n el mismo patr√≥n establecido
- La documentaci√≥n est√° completa y actualizada
